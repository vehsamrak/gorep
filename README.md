# Gorep - Golang Repository generator

Tired of hand-writing DTO's and SQL for accessing database data?
Gorep aims to automate this tedious and repeatable task for you, using boilerplate code generation.

### What is repository

Repository mediates between the domain and data mapping layers using a collection-like interface 
for accessing domain objects. (c) [Martin Fowler](https://martinfowler.com/eaaCatalog/repository.html)

### Supported databases
Only PostgreSQL is supported for now.

## Usage

There are several ways to use this package:

1. Create new DTO Generator using `gorep.NewDtoGenerator()`, which has `Generate()` method to parse database 
and create DTO contents string. Then this string could be saved to file.

2. Create new application to call from command line or go:generate.

First, create file `dto_generator.go` with main function:

```go
package main

import (
	"fmt"
	"os"

	"github.com/jmoiron/sqlx"
	_ "github.com/lib/pq"

	"github.com/vehsamrak/gorep"
)

const (
	// use your database credentials
	databaseHost     = "localhost"
	databasePort     = 5432
	databaseUser     = "user"
	databasePassword = "password"
	databaseName     = "database_name"
)

func main() {
	// pass mandatory parameters as command line arguments
	packageName := os.Args[1]
	filename := os.Args[2]
	tableName := os.Args[3]

	// connect to database
	database, err := sqlx.Connect(
		"postgres", fmt.Sprintf(
			"host=%s port=%d user=%s password=%s dbname=%s sslmode=disable",
			databaseHost, databasePort, databaseUser, databasePassword, databaseName,
		),
	)
	if err != nil {
		panic(err)
	}

	// use DtoGenerator to create DTO contents string
	generatedDtoContents, err := gorep.NewDtoGenerator(database).Generate(packageName, tableName)
	if err != nil {
		panic(err)
	}

	// write DTO contents to file
	err = os.WriteFile(filename, []byte(generatedDtoContents), 0666)
	if err != nil {
		panic(err)
	}
}
```

Now it could be called with: `go run dto_generator main example_dto.go tablename`.

Or with `go:generate`:
```go
package main

//go:generate go run dto_generator main example_dto.go tablename
```

Output of generated `example_dto.go` would look something like this:
```go
// Code was generated by GoRep. Please do not modify it!

package main

import (
    "database/sql"
    "time"
)

type TablenameDTO struct {
    Bigint sql.NullInt64 `db:"bigint"`
    Boolean sql.NullBool `db:"boolean"`
    Date sql.NullTime `db:"date"`
    Decimal sql.NullInt64 `db:"decimal"`
    DoublePrecision sql.NullFloat64 `db:"double_precision"`
    Float sql.NullFloat64 `db:"float"`
    Int sql.NullInt64 `db:"int"`
    Int2 sql.NullInt64 `db:"int2"`
    Int8 sql.NullInt64 `db:"int8"`
    Integer sql.NullInt64 `db:"integer"`
    Numeric sql.NullInt64 `db:"numeric"`
    Real sql.NullFloat64 `db:"real"`
    Serial int64 `db:"serial"`
    Smallint sql.NullInt64 `db:"smallint"`
    Text sql.NullString `db:"text"`
    Timestamp sql.NullTime `db:"timestamp"`
    TimestampNotNullable time.Time `db:"timestamp_not_nullable"`
    Varchar sql.NullString `db:"varchar"`
}
```

### Dependencies
* jmoiron/sqlx - to create DTO from database table
* mattn/go-sqlite3 - to perform SQL tests
* ory/dockertest - to test databases with docker
